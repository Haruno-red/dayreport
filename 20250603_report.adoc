= Kubernetes

== Kubernetesとは
* デプロイやスケーリングを自動化したり、コンテナ化されたアプリケーションを管理したりするためのシステム。
* 理想状態と現実状態を常に比較して近づけようとしてくれる役割を持っている。

==== ２つの構成要素（Kubernetesクラスタ）
|=======================
|Control Plane　|APIサーバを持ち、config投入の受け皿となる。
|Worker　|Control Planeとコミュニケーションを取るコンテナホスト。
|=======================
理想状態のconfigが登録されると自分たちのインフラストラクチャ上に受け取ったconfigを実現する。

Desired State（理想状態） :: yamlファイルの中に記されたPodごとのコンテナの種類や個数の設定。

== コンテナ・オーケストレーションとは
* マシンを複数台用意する、アプリケーションを複数マシンに分散する、スペック要件に合わせてデプロイする等の運用作業も設定で自動化する。 +
→運用者がやっていたことをシステムとして肩代わりしてくれる。

.機能
|=======================
|デプロイメント　|アプリケーションやバージョンのアップグレードのデプロイ方法の管理
|スケジューリング　|マシン要件や分散を設定に基づいて決定
|オートスケーリング　|コンテナ数やマシン数の増減調整
|ネットワーク　|コンテナ間のロードバランシングや通信のサービスディスカバリの提供
|リソースマネジメント　|環境ごとの使用可能なリソースの管理やデフォルト値の設定
|セキュリティ　|ネットワークの定義や各リソースの権限定義
|=======================
※Control Plane（Master）がWorker Nodeの状態を見てシステムを管理する。

== Worker Nodeの２つの構成要素
    kubelet :: Control Planeと情報連携をとるために疎通するエージェント。
    kubeproxy :: ネットワークの管理。

== Control Planeの５つの構成要素
    APIサーバ :: 内部、外部との疎通に使われる。
    ETCD :: Kubernatesクラスタの状態を保存しておくためのキーバリューストアのデータベース。
    kubescheduler :: アプリケーションのスケジュール管理。
    kube controller-manager :: 理想状態と現実状態の比較。
    cloud controller-manager :: KubernetesクラスタがCloud Providerのリソースを管理できるようにcloudのAPIと連携。

== kubectlコマンド
* 指定したKubernetesクラスタのAPIサーバのクライアントとして働く。

==== kubectlの設定（kubeconfig）の内容
|=======================
|cluster　|クラスタの指定
|user　|接続する際に使用するユーザ
|context　|クラスタとユーザの組み合わせ
|current-context　|現在のクラスタを示す
|=======================

== コンテナの復習（参考）
* 上位ディレクトリへのアクセスを制限することで、一つのマシン上で複数のユーザやプロセスが別マシンを使っているかのようにお互いに干渉せずに実行できる。
* プロセスID、ネットワークインタフェース、リソースなどが分離されていて、独立している。
* ホストマシンへの依存度が最小化されている。
